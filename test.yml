- hosts: all
  sudo: true
  pre_tasks:
      - file: name="/etc/ssl" state=directory owner=www-data
      - copy: src=test/sandstorm.crt dest=/etc/ssl/ssl_certificate.crt
      - copy: src=test/sandstorm.key dest=/etc/ssl/ssl_certificate.key
      - copy: src=test/rootCA.pem dest=/etc/ssl/rootCA.pem
  vars_files:
      - test/vars.yml
  roles:
    - role: sandcastle
      sandstorm_dev_accounts: "yes"
      ssh_debug: true
      firewall_allowed_tcp_ports:
        - 22
        - 80
        - 443
      enable_mta: true
      ssl_certificate_path: /etc/ssl/ssl_certificate.crt
      ssl_certificate_key_path: /etc/ssl/ssl_certificate.key
      ssl_trusted_certificate_path: /etc/ssl/rootCA.pem
      backup_target: file:///tmp/backup
      backup_target_password: SUPERTRASH
      backup_enc_pub_key_path: test/backup-encryption-public.key
      backup_sig_priv_key_path: test/backup-signing-private.key
      sandstorm_ciphertext_block_device: '/dev/loop0'
      filebeat_prospectors:
        - path: "/opt/sandstorm/var/log/updater.log"
          document_type: "updates"
        - path: "/opt/sandstorm/var/log/mongo.log"
          document_type: "mongo"
        - path: "/var/log/syslog"
          document_type: "syslog"
        - path: "/var/log/auth.log"
          document_type: "auth"
        - path: "/var/log/nginx/*.log"
          document_type: "nginx_landing"
        - path: "/var/log/nginx/{{ sandstorm_hostname }}/*.log"
          document_type: "reverse_proxy"
      elasticsearch_addresses:
        - 'http://172.19.22.1:9200'
      filebeat_ssl_enabled: true
      filebeat_certificate_path: test/filebeat.crt
      filebeat_certificate_key_path: test/filebeat.key
      filebeat_certificate_authorities:
        - /etc/filebeat/ssl/filebeat.crt
